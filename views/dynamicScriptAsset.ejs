export function evaluate(key, context, extra) {

    // normalise the key the same way as the server
    key = (key ?? [])?.map(i => i?.toString()?.normalize("NFKC"))?.join('__');

    // Provide libraries from context
    let Handlebars = null;
    if (extra?.libraries?.Handlebars) {
        Handlebars = extra?.libraries?.Handlebars;
    }

    let jsonata = null;
    if (extra?.libraries?.jsonata) {
        jsonata = extra?.libraries?.jsonata;
    }

    // TODO: more validation / normalisation of key or context?

    switch (key) {
    <% for (const entry of entries) { %>
        case "<%= entry.key?.toString() %>":
            return <%- entry.value %>;
    <% } %>
        default:
            throw new Error("Unknown key: " + key);
    }
};
