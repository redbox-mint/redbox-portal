<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>ReDBox Portal - NG2 Apps</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/postmark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">ReDBox Portal - NG2 Apps</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">











<ol class="breadcrumb">
  <li>Classes</li>
  <li>RecordActionResult</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>angular/shared/form/records.service.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#message">message</a>
                            </li>
                            <li>
                                <a href="#oid">oid</a>
                            </li>
                            <li>
                                <a href="#success">success</a>
                            </li>
                        </ul>
                    </td>
                </tr>






        </tbody>
    </table>
</section>


            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="message"></a>
                        <span class="name">
                            <b>
                            message</b>
                            <a href="#message"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="238" class="link-to-prism">angular/shared/form/records.service.ts:238</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="oid"></a>
                        <span class="name">
                            <b>
                            oid</b>
                            <a href="#oid"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="237" class="link-to-prism">angular/shared/form/records.service.ts:237</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="success"></a>
                        <span class="name">
                            <b>
                            success</b>
                            <a href="#success"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="236" class="link-to-prism">angular/shared/form/records.service.ts:236</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>







    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable, Inject, ApplicationRef }       from &#x27;@angular/core&#x27;;
import { FieldBase }     from &#x27;./field-base&#x27;;
import { BaseService } from &#x27;../base-service&#x27;;
import { Http } from &#x27;@angular/http&#x27;;
import &#x27;rxjs/add/operator/toPromise&#x27;;
import { FieldControlMetaService } from &#x27;./field-control-meta.service&#x27;;
import { Observable } from &#x27;rxjs/Observable&#x27;;
import * as _ from &quot;lodash&quot;;
import { ConfigService } from &#x27;../config-service&#x27;;
declare var io: any;
/**
 * Plan Client-side services
 *
 *
 *
 * Author: &lt;a href&#x3D;&#x27;https://github.com/shilob&#x27; target&#x3D;&#x27;_blank&#x27;&gt;Shilo Banihit&lt;/a&gt;
 */
@Injectable()
export class RecordsService extends BaseService {

  constructor (
    @Inject(Http) http: Http,
    @Inject(FieldControlMetaService) protected fcmetaService: FieldControlMetaService,
    @Inject(ConfigService) protected configService: ConfigService,
    protected app: ApplicationRef
  ) {
    super(http, configService);
  }

  getForm(oid: string &#x3D; null, recordType: string &#x3D; null, editable: boolean &#x3D; true, formName: string &#x3D; null) {
    if (_.isEmpty(oid)) {
      oid &#x3D; null;
    }
    return this.getFormFieldsMeta(recordType, editable, oid, formName).then((form:any) &#x3D;&gt; {
      return this.fcmetaService.getLookupData(form.fieldsMeta).flatMap((fields:any) &#x3D;&gt; {
        form.fieldsMata &#x3D; fields;
        return Observable.of(form);
      });
    });
  }

  addRenderCompleteElement(fieldsMeta){
    var renderCompleteElement &#x3D; {
            &quot;class&quot; : &quot;Container&quot;,
            &quot;compClass&quot; : &quot;TextBlockComponent&quot;,
            &quot;definition&quot; : {
                &quot;value&quot; : &quot;&quot;,
                &quot;type&quot; : &quot;span&quot;,
                &quot;cssClasses&quot; : &quot;form-render-complete&quot;
            }
        };

    fieldsMeta.push(renderCompleteElement);

  }

  getFormFields(recordType:string, oid: string&#x3D;null, editable:boolean, formName: string &#x3D; null) {
    const ts &#x3D; new Date().getTime();
    console.log(&quot;Oid is: &quot; + oid);
    const url &#x3D; oid ? &#x60;${this.brandingAndPortalUrl}/record/form/auto/${oid}?edit&#x3D;${editable}&amp;ts&#x3D;${ts}&amp;formName&#x3D;${formName}&#x60; : &#x60;${this.brandingAndPortalUrl}/record/form/${recordType}?edit&#x3D;${editable}&amp;ts&#x3D;${ts}&#x60;;
    console.log(&quot;URL is: &quot; + url);
    return this.http.get(url, this.options)
      .toPromise()
      .then((res:any) &#x3D;&gt; this.extractData(res));
  }

  getFormFieldsMeta(recordType:string, editable:boolean, oid:string&#x3D;null, formName: string &#x3D; null) {
    return this.getFormFields(recordType, oid, editable, formName).then((form:any) &#x3D;&gt; {
      if (form &amp;&amp; form.fields) {
        if(!editable){
          // Add an empty element to the end of the form so a screenshot tool can detect the rendered form reliably
          this.addRenderCompleteElement(form.fields);
        }
        form.fieldsMeta &#x3D; this.fcmetaService.getFieldsMeta(form.fields);
      } else {
        console.error(&quot;Error loading form:&quot; + recordType);
        throw form;
      }
      return form;
    });
  }

  create(record: any, recordType: string, targetStep: string &#x3D; &#x27;&#x27;) {
    return this.http.post(&#x60;${this.brandingAndPortalUrl}/recordmeta/${recordType}${ this.getTargetStepParam(targetStep, &#x27;?&#x27;) }&#x60;, record, this.getOptionsClient())
    .map((res:any) &#x3D;&gt; this.extractData(res) as RecordActionResult);
  }

  update(oid: string, record: any, targetStep: string &#x3D; &#x27;&#x27;) {
    return this.http.put(&#x60;${this.brandingAndPortalUrl}/recordmeta/${oid}${ this.getTargetStepParam(targetStep, &#x27;?&#x27;) }&#x60;, record, this.getOptionsClient())
    .map((res:any) &#x3D;&gt; this.extractData(res));
  }

  protected getTargetStepParam(targetStep, delim) {
    return _.isEmpty(targetStep) ? &#x27;&#x27; : &#x60;${delim}targetStep&#x3D;${targetStep}&#x60;;
  }

  stepTo(oid: string, record: any, targetStep: string) {
    return this.http.post(&#x60;${this.brandingAndPortalUrl}/record/workflow/step/${targetStep}/${oid}&#x60;, record, this.getOptionsClient())
    .map((res:any) &#x3D;&gt; this.extractData(res) as RecordActionResult);
  }

  getDashboardUrl(recType:string&#x3D;&#x27;rdmp&#x27;) {
    return &#x60;${this.brandingAndPortalUrl}/dashboard/${recType}&#x60;;
  }

  getAttachments(oid: string) {
    return this.http.get(&#x60;${this.brandingAndPortalUrl}/record/${oid}/attachments&#x60;, this.getOptionsClient()).toPromise()
    .then((res:any) &#x3D;&gt; this.extractData(res));
  }

  modifyEditors(records, username, email) {
    return this.http.post(&#x60;${this.brandingAndPortalUrl}/record/editors/modify&#x60;, {records:records, username:username, email:email}, this.getOptionsClient())
    .toPromise()
    .then((res:any) &#x3D;&gt; this.extractData(res) as RecordActionResult);
  }

  updateResponsibilities(records, role, updateData) {
    return this.http.post(&#x60;${this.brandingAndPortalUrl}/record/responsibility/update&#x60;, {records:records, role:role, updateData:updateData}, this.getOptionsClient())
    .toPromise()
    .then((res:any) &#x3D;&gt; this.extractData(res) as RecordActionResult);
  }

  getTransferResponsibility(recordType) {
    return this.http.get(&#x60;${this.brandingAndPortalUrl}/transferconfig/${recordType}&#x60;, this.getOptionsClient())
    .toPromise()
    .then((res:any) &#x3D;&gt; this.extractData(res) as Object);
  }

  search(params: RecordSearchParams) {
    let refinedSearchStr &#x3D; &#x27;&#x27;;
    params.filterActiveRefinersWithNoData();
    if (_.size(params.activeRefiners) &gt; 0) {
      let exactSearchNames &#x3D; &#x27;&#x27;;
      let exactSearchValues &#x3D; &#x27;&#x27;;
      let facetSearchNames &#x3D; &#x27;&#x27;;
      let facetSearchValues &#x3D; &#x27;&#x27;;
      _.forEach(params.activeRefiners, (refiner: RecordSearchRefiner)&#x3D;&gt; {
        switch (refiner.type) {
          case &quot;exact&quot;:
            exactSearchNames &#x3D; &#x60;${_.isEmpty(exactSearchNames) ? &#x60;&amp;exactNames&#x3D;&#x60; : &#x60;${exactSearchNames},&#x60;}${refiner.name}&#x60;;
            exactSearchValues &#x3D; &#x60;${exactSearchValues}&amp;exact_${refiner.name}&#x3D;${refiner.value}&#x60;;
            break;
          case &quot;facet&quot;:
            facetSearchNames &#x3D; &#x60;${_.isEmpty(facetSearchNames) ? &#x60;&amp;facetNames&#x3D;&#x60; : &#x60;${facetSearchNames},&#x60;}${refiner.name}&#x60;;
            if (!_.isEmpty(refiner.activeValue)) {
              facetSearchValues &#x3D; &#x60;${facetSearchValues}&amp;facet_${refiner.name}&#x3D;${refiner.activeValue}&#x60;;
            }
            break;
        }
      });
      refinedSearchStr &#x3D; &#x60;${exactSearchNames}${exactSearchValues}${facetSearchNames}${facetSearchValues}&#x60;;
    }
    return this.http.get(&#x60;${this.brandingAndPortalUrl}/record/search/${params.recordType}/?searchStr&#x3D;${params.basicSearch}${refinedSearchStr}&#x60;, this.getOptionsClient())
    .toPromise()
    .then((res:any) &#x3D;&gt; this.extractData(res) as RecordActionResult);
  }

  getType(name: string) {
    return this.http.get(&#x60;${this.brandingAndPortalUrl}/record/type/${name}&#x60;, this.getOptionsClient())
    .toPromise()
    .then((res:any) &#x3D;&gt; this.extractData(res));
  }

  getAllTypes() {
    return this.http.get(&#x60;${this.brandingAndPortalUrl}/record/type/&#x60;, this.getOptionsClient())
    .toPromise()
    .then((res:any) &#x3D;&gt; this.extractData(res));
  }

  async getAllTypesOfPackageType(packageType: string) {
    const allTypes &#x3D; await this.getAllTypes();
    return _.filter(allTypes, (recType:any) &#x3D;&gt; { return recType.packageType &#x3D;&#x3D; packageType });
  }

  getWorkflowSteps(name: string) {
    return this.http.get(&#x60;${this.brandingAndPortalUrl}/record/wfSteps/${name}&#x60;, this.getOptionsClient())
    .toPromise()
    .then((res:any) &#x3D;&gt; this.extractData(res));
  }

  getRecordMeta(oid:string&#x3D;null) {
    return this.http.get(&#x60;${this.brandingAndPortalUrl}/record/metadata/&#x60;+oid, this.options)
      .toPromise()
      .then((res: any) &#x3D;&gt; this.extractData(res));
  }

  getPermissions(oid:string&#x3D;null) {
    return this.http.get(&#x60;${this.brandingAndPortalUrl}/record/${oid}/permissions&#x60;, this.options)
      .toPromise()
      .then((res: any) &#x3D;&gt; this.extractData(res));
  }


  executeAction(action:string, params:any) {
    return this.http.post(&#x60;${this.brandingAndPortalUrl}/action/${action}&#x60;, params, this.options)
      .toPromise()
      .then((res: any) &#x3D;&gt; this.extractData(res));
  }

  getAsyncProgress(fq:string) {
    return this.http.get(&#x60;${this.brandingAndPortalUrl}/asynch?fq&#x3D;${fq}&#x60;, this.options)
    .toPromise()
    .then((res: any) &#x3D;&gt; this.extractData(res));
  }

  subscribeToAsyncProgress(oid: string &#x3D; null, connectCb) {
    io.socket.get(&#x60;${this.brandingAndPortalUrl}/asynch/subscribe/${oid}&#x60;, connectCb);
  }

  delete(oid: string) {
    return this.http.delete(&#x60;${this.brandingAndPortalUrl}/record/delete/${oid}&#x60;, this.getOptionsClient())
    .map((res:any) &#x3D;&gt; this.extractData(res));
  }
}

export class RecordActionResult {
  success:boolean;
  oid: string;
  message: string;
}

export class RecordSearchRefiner {
  name: string;
  title: string;
  type: string;
  value: any;
  alwaysActive: boolean;
  typeLabel: string;
  activeValue: any;

  constructor(opts: any &#x3D; {}) {
    this.name &#x3D; opts.name;
    this.title &#x3D; opts.title;
    this.type &#x3D; opts.type;
    this.value &#x3D; opts.value;
    this.typeLabel &#x3D; opts.typeLabel;
    this.alwaysActive &#x3D; opts.alwaysActive;
  }

  setCurrentValue(value: any) {
    if (this.type &#x3D;&#x3D; &quot;facet&quot;) {
      this.activeValue &#x3D; value;
    } else {
      this.value &#x3D; value;
    }
  }
}

export class RecordSearchParams {
  recordType: string;
  basicSearch: string;
  activeRefiners: any[];
  refinerConfig: RecordSearchRefiner[];

  constructor(recType: string) {
    this.recordType &#x3D; recType;
    this.activeRefiners &#x3D; [];
    this.clear();
  }

  clear() {
    this.basicSearch &#x3D; null;
    _.remove(this.activeRefiners, refiner &#x3D;&gt; {
      refiner.value &#x3D; null;
      refiner.activeValue &#x3D; null;
      return !refiner.alwaysActive;
    });
  }

  getRefinerConfig(name: string) {
    return _.find(this.refinerConfig, (config) &#x3D;&gt; {
      return config.name &#x3D;&#x3D; name;
    });
  }

  setRefinerConfig(config: RecordSearchRefiner[]) {
    this.refinerConfig &#x3D; config;
    // parse through and activate those set as active...
    _.forEach(this.refinerConfig, (refinerConfig) &#x3D;&gt; {
      if (refinerConfig.alwaysActive) {
        this.addActiveRefiner(refinerConfig);
      }
    });
  }

  getHttpQuery(searchUrl: string) {
    let refinerValues &#x3D; &#x27;&#x27;;
    _.forEach(this.activeRefiners, (refiner:RecordSearchRefiner) &#x3D;&gt; {
      if (refiner.type &#x3D;&#x3D; &quot;facet&quot;) {
        refinerValues &#x3D; &#x60;${refinerValues}&amp;refiner|${refiner.name}&#x3D;${_.isEmpty(refiner.activeValue) ? &#x27;&#x27; : refiner.activeValue}&#x60;;
      } else {
        refinerValues &#x3D; &#x60;${refinerValues}&amp;refiner|${refiner.name}&#x3D;${_.isEmpty(refiner.value) ? &#x27;&#x27; : refiner.value}&#x60;;
      }
    });
    return &#x60;${searchUrl}?q&#x3D;${this.basicSearch}&amp;type&#x3D;${this.recordType}${refinerValues}&#x60;;
  }

  getRefinerConfigs() {
    return this.refinerConfig;
  }

  addActiveRefiner(refiner: RecordSearchRefiner) {
    const existingRefiner &#x3D; _.find(this.activeRefiners, (activeRefiner:RecordSearchRefiner) &#x3D;&gt; {
      return activeRefiner.name &#x3D;&#x3D; refiner.name;
    });
    if (existingRefiner) {
      existingRefiner.value &#x3D; refiner.value;
    } else {
      this.activeRefiners.push(refiner);
    }
  }

  parseQueryStr(queryStr:string) {
    queryStr &#x3D; decodeURI(queryStr);
    let refinerValues &#x3D; {};
    _.forEach(queryStr.split(&#x27;&amp;&#x27;), (q)&#x3D;&gt; {
      const qObj &#x3D; q.split(&#x27;&#x3D;&#x27;);
      if (_.startsWith(qObj[0], &quot;q&quot;)) {
        this.basicSearch &#x3D; _.replace(qObj[1], /\+/gi, &#x27; &#x27;);
      }
      if (_.startsWith(qObj[0], &quot;refiner|&quot;)) {
        const refinerName &#x3D; qObj[0].split(&#x27;|&#x27;)[1];
        refinerValues[refinerName] &#x3D; qObj[1];
      }
    });
    _.forOwn(refinerValues, (value, name) &#x3D;&gt; {
      const config &#x3D; this.getRefinerConfig(name);
      config.setCurrentValue(value);
      this.addActiveRefiner(config);
    });
  }

  filterActiveRefinersWithNoData() {
    const removed &#x3D; _.remove(this.activeRefiners, (refiner: RecordSearchRefiner) &#x3D;&gt; {
      const value &#x3D; refiner.type &#x3D;&#x3D; &#x27;exact&#x27; ? refiner.value : refiner.activeValue;
      return  !refiner.alwaysActive &amp;&amp; (_.isEmpty(value) || _.isUndefined(value));
    });
  }

  hasActiveRefiners() {
    let hasActive &#x3D; false;
    _.forEach(this.activeRefiners, (refiner: RecordSearchRefiner) &#x3D;&gt; {
      if (!hasActive &amp;&amp; (!_.isEmpty(refiner.value))) {
        hasActive &#x3D; true;
      }
    });
    return hasActive;
  }

  setFacetValues(facets: any) {
    _.forEach(facets, (facet: any) &#x3D;&gt; {
      const refiner &#x3D; _.find(this.activeRefiners, (refinerConfig: RecordSearchRefiner) &#x3D;&gt; {
        return refinerConfig.name &#x3D;&#x3D; facet.name;
      });
      if (refiner) {
        refiner.value &#x3D; facet.values;
      }
    });
  }

}
</code></pre>
    </div>
</div>



                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'RecordActionResult.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
