<div class="container p-3">
  <div class="panel panel-default">
    <div class="panel-heading">Translation Manager</div>
    <div class="panel-body">
  

  <div class="row g-3 mb-3">
    <div class="col-md-4">
      <label class="form-label">Language</label>
      <select class="form-select" [(ngModel)]="selectedLang" (change)="onLangChange()">
        <option *ngFor="let lang of languages()" [value]="lang">{{ lang }}</option>
      </select>
    </div>
    <div class="col-md-4" *ngIf="selectedLang">
      <label class="form-label">Filter by category</label>
      <select class="form-select" [(ngModel)]="selectedCategory" (change)="onCategoryChange()">
        <option value="">All categories</option>
        <option *ngFor="let c of categories()" [value]="c">{{ c }}</option>
      </select>
    </div>
  </div>
  <!-- Status Alerts -->
  <p class="alert-info text-16 padding-10 mt-2" *ngIf="saving()">Saving translation <i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i></p>
  <p class="alert-success text-16 padding-10 mt-2" *ngIf="saveSuccess()">Translation saved successfully</p>
  <p class="alert-danger text-16 padding-10 mt-2" *ngIf="saveError()">Failed to save translation. Please try again.</p> 
  <div *ngIf="selectedLang">
    <div class="table-responsive">
      <table class="table table-sm table-striped table-hover align-middle">
        <thead>
          <tr>
            <th>
              <a href="#" role="button"
                 (click)="setSort('category'); $event.preventDefault()"
                 [attr.aria-sort]="sortBy==='category' ? (sortAsc ? 'ascending' : 'descending') : null">
                Category
                <span class="ms-1" *ngIf="sortBy==='category'">
                  <i class="fa" [ngClass]="sortAsc ? 'fa-sort-asc' : 'fa-sort-desc'"></i>
                </span>
              </a>
            </th>
            <th>
              <a href="#" role="button"
                 (click)="setSort('key'); $event.preventDefault()"
                 [attr.aria-sort]="sortBy==='key' ? (sortAsc ? 'ascending' : 'descending') : null">
                Key
                <span class="ms-1" *ngIf="sortBy==='key'">
                  <i class="fa" [ngClass]="sortAsc ? 'fa-sort-asc' : 'fa-sort-desc'"></i>
                </span>
              </a>
            </th>
            <th>
              <a href="#" role="button"
                 (click)="setSort('value'); $event.preventDefault()"
                 [attr.aria-sort]="sortBy==='value' ? (sortAsc ? 'ascending' : 'descending') : null">
                Value
                <span class="ms-1" *ngIf="sortBy==='value'">
                  <i class="fa" [ngClass]="sortAsc ? 'fa-sort-asc' : 'fa-sort-desc'"></i>
                </span>
              </a>
            </th>
            <th style="width: 100px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let e of viewEntries()">
            <td>
              <span class="text-truncate d-inline-block" style="max-width: 220px;" [title]="e.category || 'Uncategorized'">{{ e.category || 'â€”' }}</span>
            </td>
            <td>
          <span class="text-truncate d-inline-block" style="max-width: 560px;" [title]="e.key">{{ e.key }}</span>
          <a href="#" role="button" tabindex="0"
            class="badge bg-light text-dark rounded-circle border ms-1 key-help"
            [ngClass]="{ 'opacity-50': !e.description }"
            [attr.title]="e.description || 'No description'"
            [attr.aria-label]="e.description || 'No description'"
            data-toggle="tooltip"
            data-bs-toggle="tooltip"
            [attr.data-bs-title]="e.description || 'No description'"
            (click)="$event.preventDefault()">?</a>
            </td>
            <td>
              <span class="text-break" [title]="e.value">{{ e.value }}</span>
            </td>
            <td>
              <button class="btn btn-large btn-primary" (click)="openEdit(e)">Edit</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Bootstrap-styled modal (no JS) -->
  <div *ngIf="modalOpen()" class="modal fade show" tabindex="-1" style="display:block;" (click)="closeModal()">
    <div class="modal-dialog modal-lg" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Translation</h5>
          <button type="button" class="btn-close" aria-label="Close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Key</label>
            <input class="form-control" [value]="editKey" disabled />
          </div>
          <div class="mb-3">
            <label class="form-label">Value</label>
            <textarea class="form-control" rows="4" [(ngModel)]="editValue"></textarea>
          </div>
          <div class="text-muted small" *ngIf="editDescription">{{ editDescription }}</div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
          <button class="btn btn-primary" (click)="saveEdit()">Save</button>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="modalOpen()" class="modal-backdrop fade show"></div>
    </div>
  </div>
</div>
