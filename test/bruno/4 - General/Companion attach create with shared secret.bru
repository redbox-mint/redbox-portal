meta {
  name: Companion attach create with shared secret
  type: http
  seq: 3.7
}

post {
  url: {{host}}/default/rdmp/companion/record/pending-oid/attach
  body: none
  auth: none
}

headers {
  Origin: {{host}}
  Tus-Resumable: 1.0.0
  Upload-Length: 10
  Upload-Metadata: name Y29tcGFuaW9uLXRlc3QudHh0,type dGV4dC9wbGFpbg==
  X-Companion-Secret: {{companionAttachmentSecret}}
  Content-Length: 0
  Content-Type: application/x-www-form-urlencoded
}

tests {
  test("Status code is 201", function () {
    expect(res.getStatus()).to.equal(201);
  });

  test("Stores companion attachment location", function () {
    const location = res.getHeader("location");
    expect(location).to.be.a("string").and.not.be.empty;
    expect(location).to.match(/\/attach\//);
    bru.setVar("companionAttachmentLocation", location);
  });
}
