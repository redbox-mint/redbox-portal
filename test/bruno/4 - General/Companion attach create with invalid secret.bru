meta {
  name: Companion attach create with invalid secret
  type: http
  seq: 3.8
}

post {
  url: {{host}}/default/rdmp/companion/record/pending-oid/attach
  body: none
  auth: none
}

headers {
  Origin: {{host}}
  Tus-Resumable: 1.0.0
  Upload-Length: 10
  Upload-Metadata: name Y29tcGFuaW9uLWludmFsaWQudHh0,type dGV4dC9wbGFpbg==
  X-Companion-Secret: invalid-companion-secret
  Content-Length: 0
  Content-Type: application/x-www-form-urlencoded
}

tests {
  test("Status code is 403", function () {
    expect(res.getStatus()).to.equal(403);
  });

  test("Returns invalid companion secret message", function () {
    const body = res.getBody();
    const parsed = typeof body === "string" ? JSON.parse(body) : body;
    expect(parsed.message).to.equal("Invalid companion upload secret");
  });
}
